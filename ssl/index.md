SSL関連
======

## CSR生成 

以下情報が英文字で必要。

|名前|概要|例|
|----|----|
|Country |国名|JP|
|State or Province Name|都道府県|Tokyo|
|LocaltyName|市区町村|Hachioji-Shi|
|Organization Name|会社名|Sample company Inc.|
|Organizational Unit|部署名、部門名|Developing Unit|
|Common Name|ドメイン名|www.example.co.jp|

ワイルドカード証明書（サブドメインを全部許可する証明書）はCommon Nameに`*.example.co.jp` などと指定する。

### 鍵長、鍵強度、`1024bit`、`2048bit`などといった単語ついて

SSLの暗号の強さだと思って差し支えない。

古い端末（ガラケーなど）を相手にしないかぎり、2048bitでよい。
（というか、殆どの証明局（SSL証明書発行業者）が2048を必須としている）


## 発行局えらびについて

SSL通信において、高い証明書と、安い証明書で、安全性の差は基本的にない。
「廉価に販売している業者」であっても、発行局は大手が行っている事が多いので、一概に劣っているとはいえない。
どこの発行局をつかっているかで、「信頼性」、「対応しているブラウザの種類」、「使える用途」に多少差がある。

- 日本語でのサポートが必要
- ECサイトなどで、「顧客に訴える」サイトシールなどが必要
- ガラケーなど、非常に古い端末を相手にする
- EVSSLが必要
- 顧客が業者を名指し、または「良いものを」と指定した場合

上記の場合には、大手を選択するメリットや必要がある。

## 激安い証明書について

[https://ipxcore.com/ssl/](https://ipxcore.com/ssl/)
Wildcardが$42/year(Wildcardは *.example.co.jp など、まとめてサブドメインにつかえる証明書）

[https://www.namecheap.com/security/ssl-certificates/domain-validation.aspx](https://www.namecheap.com/security/ssl-certificates/domain-validation.aspx)
通常SSLが$10/yearくらい（個人的によくつかっている）


## 登録時に必要なメールアドレス

業者によってまちまちだが、

- ドメイン登録時に指定した（Whoisに登録された）メールアドレス
- そのドメインのadmin@やwebmaster@など

## Heartbleedについて

OpenSSLのVersion 1.0.1〜1.0.1eまでに存在していた脆弱性。

### OpenSSLについて

Apache+mod_sslなどの、SSL通信（HTTPS）をおこなうソフトウェアに組み込まれている。
他にも、SMTPやPOP（メール関連）や、FTPS（≠sftp）や、VPNなどで使われている。

ssh/sftpも利用しているが、今回の脆弱性が存在する箇所を利用しておらず、影響しない。

### インパクトについて

OpenSSLを組み込んだソフトウェアのプロセスメモリを、インターネット越しなどでランダムに読み取りできる。
必ずなにか重要な情報を盗めるわけではない。

- SSL証明書、秘密鍵
- ユーザーの送信したデータ(ログイン時にはID/PASSなど）
- プログラムが利用しているデータ（変数、ソースコード、内部的な情報）

等を読み取れる可能性がある。


### 「ログなどで確認はできないか？」

「今までをさかのぼっておこなうことは出来ない」

ただし、「新たに」取得するようにすることは可能。しかし、対策完了すれば、もはや意味はない。


### 「今後このような事がおこらないようにしたい」

基本的に脆弱性をすべてふさぐ事や、その予測は不可能、今回も極一部の人しかしらなかったバグである。

根本的な設計を見直し、「強い」システムにすることが、ベターである。
サーバーを分割して疎結合にし（WebとDBを分けたり）、なにか発生した時にそれを知り、迅速に対応できる体制作りをすることが望ましい。

ソフトウェアのバージョンをできるだけ最新に保ち続ける体制を整える事も重要。

Web Application FirewallやIDSなどといった機器を使う事も想定できるが、やはり「未知」への対応は困難であるし、多大なコストがかかる。

### 「安全のためにOpenSSLのバージョンを下げたい」

- 今回の件については、バージョンアップすれば解決する
- 下げる事ができないサーバーの状態がある
（基本的にライブラリは相互に依存しており、あるものだけを引き下げるのは非常に大変である）
- 古いバージョンには、また別途別の脆弱性があったり、その修正が行われてない。

### 「最新は危ないのでやめたい」

前提として

- 古い方がバグが多い（新しいものはバグ修正がつづく）
- 未来にわたって「このバージョンなら安全」というものはない（みつかっていないバグの存在が推測される）

今回、新しく追加された致命的なバグだったが、古いバージョンを使い続けると今回以外のバグが修正されない（ていない）。
それらが「脅威として低い」という判断もあるが、その視点ならばHeartBeatのバグが解消された最新版の方がのぞましい。

一般的に、Linuxディストリビュージョンの配布先から、修正のパッチが出るので、最新版にそろえていくことが「正しい責任の取り方」だと思われる。
古いバージョンにこだわるのは、別途自前でそれらをまかなう事に等しい。


### 対応方法

- opensslのバージョンを上げる
- （窃盗されたと仮定して）証明書を交換する
- （可能であれば）ユーザーにパスワード変更を要求する
- 「OpenSSLが組み込まれたプロセスで動作する」コード内になんらかの秘匿情報があれば、それも変更することが望ましい

> CentOSなどでは、Openssl1.0.1eにパッチを当てたパッケージを配布したので、バージョン名をそのまま脆弱性の存在とイコールにしてはならない。




